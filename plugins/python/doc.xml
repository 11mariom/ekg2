<sect2>
   <title>Interfejs od strony interpretera</title>
   <sect3>
      <title>Modu³ ekg</title>
      <variablelist>
         <title>Metody i atrybuty modu³u</title>
         <varlistentry>
            <term>command(str)</term>
            <listitem>
               <para>
                  Wywo³anie polecenia ekg
               </para>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>printf(format, args ...)</term>
            <listitem>
               <para>
                  Wy¶wietlenie tekstu w podanym formacie.
               </para>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>echo(str)</term>
            <listitem>
               <para>
                  Wy¶wietlenie tekstu w formacie generic
               </para>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>debug(format, args ...)</term>
            <listitem>
               <para>
                  Zapisanie danych debugowych w podanym formacie (notacja printf).
               </para>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>sessions()</term>
            <listitem>
               <para>
                  Zwraca listê zawieraj±c± dostêpne sesje.
               </para>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>plugins()</term>
            <listitem>
               <para>
                  Zwraca listê zawieraj±ca za³adowane pluginy.
               </para>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>config</term>
            <listitem>
               <para>
                  S³ownik zawieraj±cy opcjê konfiguracji ekg (odczyt i zapis)
               </para>
            </listitem>
         </varlistentry>
      </variablelist>
      <variablelist>
         <title>Sta³e</title>
         <varlistentry>
            <term>MSGCLASS_MESSAGE</term>
            <listitem>
               <formalpara>
                  <title>typ wiadomo¶ci</title>
                  <para>
                     wiadomo¶æ
                  </para>
               </formalpara>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>MSGCLASS_CHAT</term>
            <listitem>
               <formalpara>
                  <title>typ wiadomo¶ci</title>
                  <para>
                     rozmowa ci±g³a
                  </para>
               </formalpara>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>MSGCLASS_SENT</term>
            <listitem>
               <formalpara>
                  <title>typ wiadomo¶ci</title>
                  <para>
                     wys³ana wiadomo¶æ
                  </para>
               </formalpara>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>MSGCLASS_SENT_CHAT</term>
            <listitem>
               <formalpara>
                  <title>typ wiadomo¶ci</title>
                  <para>
                     wys³ana wiadomo¶æ w ramach rozmowy ci±g³ej
                  </para>
               </formalpara>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>MSGCLASS_SYSTEM</term>
            <listitem>
               <formalpara>
                  <title>typ wiadomo¶ci</title>
                  <para>
                     wiadomo¶æ systemowa
                  </para>
               </formalpara>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>STATUS_NA</term>
            <listitem>
               <formalpara>
                  <title>stan</title>
                  <para>
                     Not Available (roz³±czony)
                  </para>
               </formalpara>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>STATUS_AVAIL</term>
            <listitem>
               <formalpara>
                  <title>stan</title>
                  <para>
                     Available (dostêpny)
                  </para>
               </formalpara>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>STATUS_AWAY</term>
            <listitem>
               <formalpara>
                  <title>stan</title>
                  <para>
                     Away (z dala od klawiatury)
                  </para>
               </formalpara>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>STATUS_AUTOAWAY</term>
            <listitem>
               <formalpara>
                  <title>stan</title>
                  <para>
                     Auto Away (automatyczny stan bezczynno¶ci)
                  </para>
               </formalpara>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>STATUS_INVISIBLE</term>
            <listitem>
               <formalpara>
                  <title>stan</title>
                  <para>
                     Invisible (niewidoczny)
                  </para>
               </formalpara>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>STATUS_XA</term>
            <listitem>
               <formalpara>
                  <title>stan</title>
                  <para>
                     Extended Away (niedostêpny)
                  </para>
               </formalpara>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>STATUS_DND</term>
            <listitem>
               <formalpara>
                  <title>stan</title>
                  <para>
                     Do Not Disturb (nie przeszkadzaæ)
                  </para>
               </formalpara>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>STATUS_FREE_FOR_CHAT</term>
            <listitem>
               <formalpara>
                  <title>stan</title>
                  <para>
                     Free for Chat (chêtny do rozmowy)
                  </para>
               </formalpara>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>STATUS_BLOCKED</term>
            <listitem>
               <formalpara>
                  <title>stan</title>
                  <para>
                     Blocked (zablokowany)
                  </para>
               </formalpara>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>STATUS_UNKNOWN</term>
            <listitem>
               <formalpara>
                  <title>stan</title>
                  <para>
                     Unknown (nieznany)
                  </para>
               </formalpara>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>STATUS_ERROR</term>
            <listitem>
               <formalpara>
                  <title>stan</title>
                  <para>
                     Error (b³±d)
                  </para>
               </formalpara>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>IGNORE_STATUS</term>
            <listitem>
               <formalpara>
                  <title>ignorowanie</title>
                  <para>
                     zmian stanu
                  </para>
               </formalpara>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>IGNORE_STATUS_DESCR</term>
            <listitem>
               <formalpara>
                  <title>ignorowanie</title>
                  <para>
                     stanów z opisem
                  </para>
               </formalpara>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>IGNORE_MSG</term>
            <listitem>
               <formalpara>
                  <title>ignorowanie</title>
                  <para>
                     wiadomo¶ci
                  </para>
               </formalpara>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>IGNORE_DCC</term>
            <listitem>
               <formalpara>
                  <title>ignorowanie</title>
                  <para>
                     po³±czeñ bezpo¶rednich (DCC)
                  </para>
               </formalpara>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>IGNORE_EVENTS</term>
            <listitem>
               <formalpara>
                  <title>ignorowanie</title>
                  <para>
                     zdarzeñ
                  </para>
               </formalpara>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>IGNORE_NOTIFY</term>
            <listitem>
               <formalpara>
                  <title>ignorowanie</title>
                  <para>
                     powiadomieñ
                  </para>
               </formalpara>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>IGNORE_ALL</term>
            <listitem>
               <formalpara>
                  <title>ignorowanie</title>
                  <para>
                     wszystkiego
                  </para>
               </formalpara>
            </listitem>
         </varlistentry>
      </variablelist>
   </sect3>
   <sect3>
      <title>Obiekt session</title>
      <variablelist>
         <title>Metody i pola obiektu session</title>
         <varlistentry>
            <term>self</term>
            <listitem>
               <para>
                  S³ownikowy dostêp do konfiguracji sesji. 
               </para>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>connect() (NFY)</term>
            <listitem>
               <para>
                  £±czy sesjê.
               </para>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>disconnect() (NFY)</term>
            <listitem>
               <para>
                  Roz³±cza sesjê().
               </para>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>connected()</term>
            <listitem>
               <para>
                  Zwraca True je¶li sesja jest po³±czona, False wpp.
               </para>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>status() (NFY)</term>
            <listitem>
               <para>
                  Zwraca tuple [ status, opis ], gdzie status jest jedn± ze
                  sta³ych okre¶laj±cych typ stanu.
               </para>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>users (NFY)</term>
            <listitem>
               <para>
                  S³ownik zawieraj±cy obiekty typu user (kluczowane po
                  identyfikatorze - gg:123, jid:test@example.com itp.)
               </para>
            </listitem>
         </varlistentry>
      </variablelist>
   </sect3>
   <sect3>
      <title>Klasa user (NFY)</title>
      <para>
         Obiekt zawiera atrybutowy dostêp do informacji o obiekcie:
      </para>
      <itemizedlist>
         <listitem>
            <para>
               id
            </para>
         </listitem>
         <listitem>
            <para>
               name
            </para>
         </listitem>
         <listitem>
            <para>
               groups[]
            </para>
         </listitem>
         <listitem>
            <para>
               status
            </para>
         </listitem>
         <listitem>
            <para>
               desc
            </para>
         </listitem>
         <listitem>
            <para>
               lastseen
            </para>
         </listitem>
      </itemizedlist>
   </sect3>
</sect2>
<sect2>
   <title>Funkcje skryptów wywo³ywane przez ekg</title>
   <variablelist>
      <varlistentry>
         <term>init()</term>
         <listitem>
            <para>
               Wywo³ywana gdy skrypt jest ³adowany. Je¶li ta funkcja zwróci 0,
               skrypt nie zostanie za³adowanych.
            </para>
         </listitem>
      </varlistentry>
      <varlistentry>
         <term>deinit()</term>
         <listitem>
            <para>
               Wywo³ywana gdy skrypt jest usuwany z pamiêci.
            </para>
         </listitem>
      </varlistentry>
      <varlistentry>
         <term>handle_msg(session, id, class, text, time, ignore_level)</term>
         <listitem>
            <para>
               Wywo³ywana gdy ekg otrzymuje wiadomo¶æ.
            </para>
         </listitem>
      </varlistentry>
      <varlistentry>
         <term>handle_msg_own(session, rcpts, text)</term>
         <listitem>
            <para>
               Wywo³ywana gdy u¿ytkownik wysy³a wiadomo¶æ. rcpts jest
               <emphasis>tekstow±</emphasis> reprezentacj± odbiorcy, dok³adnie
               tak± jak poda³ u¿ytkownik (pierwszy argument /msg, /chat, /query
               itd).
            </para>
         </listitem>
      </varlistentry>
      <varlistentry>
         <term>handle_status(session, from, type, desc)</term>
         <listitem>
            <para>
               Wywo³ywana gdy kto¶ zmienia stan. nazwy parametrów powinny byæ
               zrozumia³e.  je¶li zwróci 0, zmiana stanu zostanie zignorowana.
               je¶li zwróci 2, zmiana stanu nie bêdzie ignorowana, ale nie
               zostanie wy¶wietlona. je¶li zwróci krotkê o takich samych
               argumentach jak funkcja, dane zostan± zmienione.
            </para>  
         </listitem>
      </varlistentry>
      <varlistentry>
         <term>handle_status_own(status, desc) (NFY)</term>
         <listitem>
            <para>
               Wywo³ywana gdy klient zmienia stan. je¶li zwróci 0, stan nie
               zostanie zmieniony.
            </para>
         </listitem>
      </varlistentry>
   </variablelist>
</sect2>
<sect2>
   <title>Przyk³adowy skrypt</title>
   <programlisting role="python">
<![CDATA[
# -*- encoding: iso-8859-2 -*-

import ekg
import time

def handle_status(session, uid, status, desc):
    for name in ekg.sessions():
	sesja = ekg.getSession(name)
	if sesja.connected():
	    ekg.echo("sesja '%s' po³±czona" % (name,))
	    ekg.echo("status: "+sesja['status'])
	    ekg.echo("ustawiam t± sesjê jako domy¶ln±")
	    sesja['default'] = "1"
	else:
	    ekg.echo("sesja '%s' nie jest po³±czona" % (name,))
    ekg.echo("Dosta³em status!")
    ekg.echo("Sesja : "+session)
    ekg.echo("UID   : "+uid)
    ekg.echo("Status: "+status)
    if desc:
	ekg.echo("Opis  : "+desc)
    if status == ekg.STATUS_AWAY:
	ekg.echo("Chyba go nie ma...")
    if status == ekg.STATUS_XA:
	ekg.echo("Chyba bardzo go nie ma, to na grzyb mi taki status?. Po³ykam. *¶lurp*")
	return 0
    return 1

def handle_msg(session, uid, type, text, sent_time, ignore_level):
    ekg.debug("[test script] some debug\n")
    ekg.echo("Dosta³em wiadomo¶æ!")
    ekg.echo("Sesja : "+session)
    ekg.echo("UID   : "+uid)
    if type == ekg.MSGCLASS_MESSAGE:
	ekg.echo("Typ   : msg")
    elif type == ekg.MSGCLASS_CHAT:
	ekg.echo("Typ   : chat")
    ekg.echo("Czas  : "+time.strftime("%a, %d %b %Y %H:%M:%S %Z", time.gmtime(sent_time)))
    ekg.echo("Ign   : "+str(ignore_level))
    ekg.echo("TxtLen: "+str(len(text)))
    if len(text) == 13:
	ekg.echo("Oj, ale pechowa liczba, nie odbieram")
	return 0
    return 1

def handle_msg_own(session, target, text):
    ekg.debug("[test script] some debug\n")
    ekg.echo("Wysy³am wiadomo¶æ!")
    ekg.echo("Sesja : "+session)
    ekg.echo("Target: "+target)
    ekg.echo("TxtLen: "+str(len(text)))
    return 1

def handle_connect(session):
    ekg.echo("Po³±czono! Ale super! Mo¿na gadaæ!")
    ekg.echo("Sesja : "+session)
    if session[:3] == 'irc':
	struct = time.gmtime()
	if struct[3] >= 8 and struct[3] < 17:
	    ekg.echo('£adnie to tak ircowaæ w pracy? ;)')
    sesja = ekg.getSession(session)
    if sesja.connected():
	ekg.echo('Po³±czony!')
    else:
	ekg.echo('W tym miejscu jeszcze nie po³±czony')

def handle_disconnect(session):
    ekg.echo("£o, sesja %s nam pad³a" % (session,))
    ekg.echo("Wysy³amy smsa ¿e nam cu¶ pad³o...")
]]>
   </programlisting>
</sect2>
<!--
vim: ft=docbk encoding=iso-8859-2
-->
