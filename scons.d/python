
# python

Import('*')

import sys, distutils.sysconfig

pyver		= sys.version[0:3]
pyprefix	= sys.prefix
pyxprefix	= sys.exec_prefix

includedir	= '%s/include/python%s' % (pyprefix, pyver)

try:
	old_cpppath		= env['CPPPATH']
except KeyError:
	old_cpppath		= []
env.Append(CPPPATH = [includedir])
out = conf.CheckHeader(['Python.h'])
env['CPPPATH']	= old_cpppath

if out:
	libdir		= '%s/lib/python%s/config' % (pyxprefix, pyver)
	try:
		makefile	= distutils.sysconfig.parse_makefile('%s/Makefile' % libdir)
		
		for var, val in makefile.items():
			if var in ['LOCALMODLIBS', 'BASEMODLIBS', 'OTHER_LIBS', 'OTHER_LIBC', 'OTHER_LIBM']:
				val = distutils.sysconfig.expand_makefile_vars(val, makefile)
				for arg in val.split():
					flags.append(arg)

		libs.append('python%s' % pyver)
		flags.append('-L%s/lib' % pyxprefix)
		flags.append('-L%s' % libdir)
		flags.append('-I%s' % includedir)
	except:
		warnings.append("Unable to read Python's Makefile (%s/Makefile)" % libdir)
		out = False

Return('out')

# vim:ts=4:sts=4:sw=4:syntax=python
